"use strict";(self.webpackChunkstorybook=self.webpackChunkstorybook||[]).push([[8525],{"../packages/ui/core/components/QueryBuilder/utils/useQueryBuilderState.js":(__unused_webpack_module,exports,__webpack_require__)=>{function _array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _array_with_holes(arr){if(Array.isArray(arr))return arr}function _array_without_holes(arr){if(Array.isArray(arr))return _array_like_to_array(arr)}function _iterable_to_array(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _iterable_to_array_limit(arr,i){var _s,_e,_i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}function _non_iterable_rest(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _non_iterable_spread(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _sliced_to_array(arr,i){return _array_with_holes(arr)||_iterable_to_array_limit(arr,i)||_unsupported_iterable_to_array(arr,i)||_non_iterable_rest()}function _to_consumable_array(arr){return _array_without_holes(arr)||_iterable_to_array(arr)||_unsupported_iterable_to_array(arr)||_non_iterable_spread()}function _unsupported_iterable_to_array(o,minLen){if(o){if("string"==typeof o)return _array_like_to_array(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array(o,minLen)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getQueryBuilderState=exports.defaultQueryBuilderState=exports.setQueryBuilderState=exports.addPillToQueryBuilder=exports.removePillFromQueryBuilder=exports.updateQueryByTableFilter=exports.updateQuery=exports.updateActiveQueryField=exports.updateActiveQueryFilters=exports.getActiveQuery=exports.addQuery=exports.QB_CACHE_KEY_PREFIX=exports.QB_UPDATE_EVENT_KEY=void 0;var react_1=__webpack_require__("./node_modules/react/index.js"),lodash_1=__webpack_require__("../packages/ui/node_modules/lodash/lodash.js"),uuid_1=__webpack_require__("../packages/ui/node_modules/uuid/dist/esm-browser/index.js"),operators_1=__webpack_require__("../packages/ui/core/data/sqon/operators.js"),types_1=__webpack_require__("../packages/ui/core/data/sqon/types.js"),utils_1=__webpack_require__("../packages/ui/core/data/sqon/utils.js");exports.QB_UPDATE_EVENT_KEY="QBCacheUpdate",exports.QB_CACHE_KEY_PREFIX="query-builder-cache",exports.addQuery=function(param){var _a,_b,query=param.query,queryBuilderId=param.queryBuilderId,_param_setAsActive=param.setAsActive,qbState=(0,exports.getQueryBuilderState)(queryBuilderId),queries=null!==(_a=null==qbState?void 0:qbState.state)&&void 0!==_a?_a:[],hasEmptyQuery=queries.find(function(param){var content=param.content;return(0,lodash_1.isEmpty)(content)});(0,exports.setQueryBuilderState)(queryBuilderId,{active:void 0!==_param_setAsActive&&_param_setAsActive?query.id:null!==(_b=null==qbState?void 0:qbState.active)&&void 0!==_b?_b:query.id,state:hasEmptyQuery?queries.map(function(cQuery){return(0,lodash_1.isEmpty)(cQuery.content)?query:cQuery}):_to_consumable_array(queries).concat([query])})},exports.getActiveQuery=function(queryBuilderId){var _a,_b,qbState=(0,exports.getQueryBuilderState)(queryBuilderId);return null!==(_b=null===(_a=null==qbState?void 0:qbState.state)||void 0===_a?void 0:_a.find(function(param){return param.id===qbState.active}))&&void 0!==_b?_b:{content:[],op:operators_1.BooleanOperators.and}},exports.updateActiveQueryFilters=function(param){var filterGroup=param.filterGroup,index=param.index,operator=param.operator,queryBuilderId=param.queryBuilderId,selectedFilters=param.selectedFilters;return(0,exports.updateQuery)({query:(0,utils_1.getUpdatedActiveQueryByFilterGroup)({filterGroup:filterGroup,index:index,operator:operator,queryBuilderId:queryBuilderId,selectedFilters:selectedFilters}),queryBuilderId:queryBuilderId})},exports.updateActiveQueryField=function(param){var field=param.field,index=param.index,isUploadedList=param.isUploadedList,_param_merge_strategy=param.merge_strategy,merge_strategy=void 0===_param_merge_strategy?types_1.MERGE_VALUES_STRATEGIES.APPEND_VALUES:_param_merge_strategy,_param_operator=param.operator,operator=void 0===_param_operator?operators_1.TermOperators.in:_param_operator,overrideValuesName=param.overrideValuesName,queryBuilderId=param.queryBuilderId,remoteComponent=param.remoteComponent,value=param.value;return(0,exports.updateQuery)({query:(0,lodash_1.isEmpty)(value)?(0,utils_1.removeFieldFromActiveQuery)(queryBuilderId,field):(0,utils_1.deepMergeFieldInActiveQuery)({field:field,index:index,isUploadedList:isUploadedList,merge_strategy:merge_strategy,operator:operator,overrideValuesName:overrideValuesName,queryBuilderId:queryBuilderId,remoteComponent:remoteComponent,value:value}),queryBuilderId:queryBuilderId})},exports.updateQuery=function(param){var _a,query=param.query,queryBuilderId=param.queryBuilderId,qbState=(0,exports.getQueryBuilderState)(queryBuilderId),queryToUpdate=null===(_a=null==qbState?void 0:qbState.state)||void 0===_a?void 0:_a.find(function(param){return param.id===query.id});queryToUpdate&&(queryToUpdate.content=query.content,queryToUpdate.op=query.op),qbState&&(0,exports.setQueryBuilderState)(queryBuilderId,qbState)},exports.updateQueryByTableFilter=function(param){var field=param.field,queryBuilderId=param.queryBuilderId,selectedFilters=param.selectedFilters;return(0,exports.updateQuery)({query:selectedFilters.length>0?(0,utils_1.getUpdatedActiveQuery)({field:field,queryBuilderId:queryBuilderId,sqonContent:(0,utils_1.createInlineFilters)(field,selectedFilters)}):(0,utils_1.removeFieldFromActiveQuery)(queryBuilderId,field),queryBuilderId:queryBuilderId})},exports.removePillFromQueryBuilder=function(pillId,queryBuilderId){var _a,qbState=(0,exports.getQueryBuilderState)(queryBuilderId),updatedState=null===(_a=null==qbState?void 0:qbState.state)||void 0===_a?void 0:_a.map(function(sqon){var newContent=sqon.content.map(function(sqonContent){if(sqonContent.id!==pillId)return sqonContent});return Object.assign(Object.assign({},sqon),{content:newContent.filter(function(el){return void 0!==el})})});(0,exports.setQueryBuilderState)(queryBuilderId,Object.assign(Object.assign({},qbState),{state:updatedState}))},exports.addPillToQueryBuilder=function(pill,queryBuilderId){var activeQuery=(0,exports.getActiveQuery)(queryBuilderId);(0,exports.updateQuery)({query:Object.assign(Object.assign({},activeQuery),{content:_to_consumable_array(activeQuery.content).concat([pill])}),queryBuilderId:queryBuilderId})},exports.setQueryBuilderState=function(queryBuilderId,value){var QBUpdateEvent=new Event(exports.QB_UPDATE_EVENT_KEY);QBUpdateEvent.qbID=queryBuilderId,QBUpdateEvent.value=value,window.localStorage.setItem("".concat(exports.QB_CACHE_KEY_PREFIX,"-").concat(queryBuilderId),JSON.stringify(value)),document.dispatchEvent(QBUpdateEvent)},exports.defaultQueryBuilderState=function(queryBuilderId){var defaultSqon=(0,utils_1.getDefaultSyntheticSqon)(),newQbState={active:defaultSqon.id,state:[defaultSqon]};return(0,exports.setQueryBuilderState)(queryBuilderId,newQbState),newQbState},exports.getQueryBuilderState=function(queryBuilderId){var qbState=window.localStorage.getItem("".concat(exports.QB_CACHE_KEY_PREFIX,"-").concat(queryBuilderId));if(!qbState)return(0,exports.defaultQueryBuilderState)(queryBuilderId);try{return JSON.parse(qbState)}catch(err){return(0,exports.defaultQueryBuilderState)(queryBuilderId)}},exports.default=function(queryBuilderId){var _a,_ref=_sliced_to_array((0,react_1.useState)((0,exports.getQueryBuilderState)(queryBuilderId)),2),state=_ref[0],setState=_ref[1];return(0,react_1.useEffect)(function(){var listener=function(event){var _a,_b,_c,_d;event.qbID===queryBuilderId&&setState({active:null!==(_b=null===(_a=event.value)||void 0===_a?void 0:_a.active)&&void 0!==_b?_b:(0,uuid_1.v4)(),state:null!==(_d=null===(_c=event.value)||void 0===_c?void 0:_c.state)&&void 0!==_d?_d:[]})};return document.addEventListener(exports.QB_UPDATE_EVENT_KEY,listener),function(){return window.removeEventListener(exports.QB_UPDATE_EVENT_KEY,listener)}},[]),{activeQuery:(0,exports.getActiveQuery)(queryBuilderId),activeQueryId:null==state?void 0:state.active,queryList:null!==(_a=null==state?void 0:state.state)&&void 0!==_a?_a:[],state:state}}},"../packages/ui/core/components/filters/types.js":(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.VisualType=void 0,function(VisualType){VisualType.Checkbox="checkbox",VisualType.Toggle="toggle",VisualType.Range="range",VisualType.Text="text",VisualType.OntologyTree="nested"}(exports.VisualType||(exports.VisualType={}))},"../packages/ui/core/data/arranger/formatting.js":(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.underscoreToDot=exports.dotToUnderscore=exports.keyEnhance=exports.AggregateValues=exports.ArrangerValues=void 0,exports.ArrangerValues={false:"0",missing:"__missing__",noData:"No Data",true:"1"},exports.AggregateValues={false:"false",true:"true"},exports.keyEnhance=function(key){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:exports.ArrangerValues.noData;return key===exports.ArrangerValues.missing?s:key},exports.dotToUnderscore=function(str){return str.replaceAll(".","__")},exports.underscoreToDot=function(str){return str.replaceAll("__",".")}},"../packages/ui/core/data/filters/Range.js":(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.isRangeAgg=exports.getRangeSelection=exports.getSelectedFiltersForRange=void 0;var formatting_1=__webpack_require__("../packages/ui/core/data/arranger/formatting.js"),operators_1=__webpack_require__("../packages/ui/core/data/sqon/operators.js"),utils_1=__webpack_require__("../packages/ui/core/data/sqon/utils.js");exports.getSelectedFiltersForRange=function(filters,filterGroup,selectedFilters){var rangeData=(0,exports.getRangeSelection)(selectedFilters,filterGroup);return filters.map(function(f){return Object.assign(Object.assign({},f),{data:rangeData})})};var hasValueMissing=function(content){return content.value.includes(formatting_1.ArrangerValues.missing)};exports.getRangeSelection=function(filters,filterGroup){var rangeSelection={max:void 0,min:void 0,operator:(null===(_a=filterGroup.config)||void 0===_a?void 0:_a.defaultOperator)?operators_1.RangeOperators[null===(_b=filterGroup.config)||void 0===_b?void 0:_b.defaultOperator]:operators_1.RangeOperators["<"],rangeType:void 0},_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _a,_b,_step,_iterator=filters.content[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var filter=_step.value,noDataSelected=!1,filt=filter;if(!(0,utils_1.isReference)(filter)){if((0,utils_1.isBooleanOperator)(filter)&&filter.content.some(function(param){var content=param.content;return hasValueMissing(content)})&&(noDataSelected=!0,filt=filter.content.find(function(param){var content=param.content;return!hasValueMissing(content)})),filt.content.field!==filterGroup.field)continue;switch(filt.op){case operators_1.RangeOperators.between:rangeSelection=Object.assign(Object.assign({},rangeSelection),{max:filt.content.value[1],min:filt.content.value[0],noDataSelected:noDataSelected,operator:operators_1.RangeOperators.between});break;case operators_1.RangeOperators["<"]:case operators_1.RangeOperators["<="]:rangeSelection=Object.assign(Object.assign({},rangeSelection),{max:filt.content.value[0],noDataSelected:noDataSelected,operator:operators_1.RangeOperators[filt.op]});break;case operators_1.RangeOperators[">"]:case operators_1.RangeOperators[">="]:rangeSelection=Object.assign(Object.assign({},rangeSelection),{min:filt.content.value[0],noDataSelected:noDataSelected,operator:operators_1.RangeOperators[filt.op]});break;case operators_1.RangeOperators.in:rangeSelection=Object.assign(Object.assign({},rangeSelection),{noDataSelected:!0,operator:operators_1.RangeOperators[filt.op]})}}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return rangeSelection},exports.isRangeAgg=function(obj){return!!obj.stats}},"../packages/ui/core/data/sqon/operators.js":(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.FilterOperators=exports.BooleanOperators=exports.TermOperators=exports.RangeOperators=exports.FieldOperators=void 0,function(FieldOperators){FieldOperators[">"]=">",FieldOperators["<"]="<",FieldOperators.between="between",FieldOperators[">="]=">=",FieldOperators["<="]="<=",FieldOperators.in="in",FieldOperators["not-in"]="not-in",FieldOperators["some-not-in"]="some-not-in",FieldOperators.all="all"}(exports.FieldOperators||(exports.FieldOperators={})),function(RangeOperators){RangeOperators[">"]=">",RangeOperators["<"]="<",RangeOperators.between="between",RangeOperators[">="]=">=",RangeOperators["<="]="<=",RangeOperators.in="in"}(exports.RangeOperators||(exports.RangeOperators={})),function(TermOperators){TermOperators.in="in",TermOperators["not-in"]="not-in",TermOperators.all="all",TermOperators["some-not-in"]="some-not-in"}(exports.TermOperators||(exports.TermOperators={})),function(BooleanOperators){BooleanOperators.and="and",BooleanOperators.or="or",BooleanOperators.not="not"}(exports.BooleanOperators||(exports.BooleanOperators={})),(exports.FilterOperators||(exports.FilterOperators={})).filter="filter"},"../packages/ui/core/data/sqon/types.js":(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.MERGE_OPERATOR_STRATEGIES=exports.MERGE_VALUES_STRATEGIES=exports.SET_ID_PREFIX=void 0,exports.SET_ID_PREFIX="set_id:",function(MERGE_VALUES_STRATEGIES){MERGE_VALUES_STRATEGIES.DEFAULT="OVERRIDE_VALUES",MERGE_VALUES_STRATEGIES.OVERRIDE_VALUES="OVERRIDE_VALUES",MERGE_VALUES_STRATEGIES.APPEND_VALUES="APPEND_VALUES"}(exports.MERGE_VALUES_STRATEGIES||(exports.MERGE_VALUES_STRATEGIES={})),function(MERGE_OPERATOR_STRATEGIES){MERGE_OPERATOR_STRATEGIES.DEFAULT="OVERRIDE_OPERATOR",MERGE_OPERATOR_STRATEGIES.OVERRIDE_OPERATOR="OVERRIDE_OPERATOR",MERGE_OPERATOR_STRATEGIES.KEEP_OPERATOR="KEEP_OPERATOR"}(exports.MERGE_OPERATOR_STRATEGIES||(exports.MERGE_OPERATOR_STRATEGIES={}))},"../packages/ui/core/data/sqon/utils.js":(__unused_webpack_module,exports,__webpack_require__)=>{function _array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _array_without_holes(arr){if(Array.isArray(arr))return _array_like_to_array(arr)}function _iterable_to_array(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _non_iterable_spread(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _to_consumable_array(arr){return _array_without_holes(arr)||_iterable_to_array(arr)||_unsupported_iterable_to_array(arr)||_non_iterable_spread()}function _type_of(obj){return obj&&"undefined"!=typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj}function _unsupported_iterable_to_array(o,minLen){if(o){if("string"==typeof o)return _array_like_to_array(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array(o,minLen)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.findNestedSqonFields=exports.isFilterSelected=exports.getEmptyCountFilter=exports.hasExtraFilterSelected=exports.formatExtraFilters=exports.getSelectedFilters=exports.createInlineFilters=exports.createRangeFilter=exports.hasSelectedRangeForOperator=exports.createTextFilter=exports.createSQONFromFilters=exports.getUpdatedActiveQuery=exports.getUpdatedActiveQueryByFilterGroup=exports.removeFieldFromActiveQuery=exports.removeFieldFromSqon=exports.findSqonValueByField=exports.generateWildCardValueFilter=exports.generateValueFilter=exports.generateQuery=exports.deepMergeFieldInActiveQuery=exports.deepMergeSqonValue=exports.addToSqons=exports.termToSqon=exports.removeQueryFromSqon=exports.removeContentFromSqon=exports.isIndexReferencedInSqon=exports.changeCombineOperator=exports.removeSqonAtIndex=exports.resolveSyntheticSqon=exports.getDefaultSyntheticSqon=exports.generateEmptyQuery=exports.isCustomPill=exports.isRangeFilter=exports.isBooleanFilter=exports.isFieldOperator=exports.isBooleanOperator=exports.isRemoteComponent=exports.isUploadedList=exports.isNotSet=exports.isSet=exports.isNotReference=exports.isReference=exports.isNotEmptySqon=exports.isEmptySqon=void 0;var lodash_1=__webpack_require__("../packages/ui/node_modules/lodash/lodash.js"),uuid_1=__webpack_require__("../packages/ui/node_modules/uuid/dist/esm-browser/index.js"),types_1=__webpack_require__("../packages/ui/core/components/filters/types.js"),useQueryBuilderState_1=__webpack_require__("../packages/ui/core/components/QueryBuilder/utils/useQueryBuilderState.js"),formatting_1=__webpack_require__("../packages/ui/core/data/arranger/formatting.js"),Range_1=__webpack_require__("../packages/ui/core/data/filters/Range.js"),operators_1=__webpack_require__("../packages/ui/core/data/sqon/operators.js"),types_2=__webpack_require__("../packages/ui/core/data/sqon/types.js");exports.isEmptySqon=function(sqon){return!Object.keys(sqon).length||(0,lodash_1.isEmpty)(null==sqon?void 0:sqon.content)},exports.isNotEmptySqon=function(sqon){return!(0,exports.isEmptySqon)(sqon)},exports.isReference=function(sqon){return!(0,exports.isNotReference)(sqon)},exports.isNotReference=function(sqon){return isNaN(sqon)},exports.isSet=function(value){return value.content.value&&value.content.value.some(function(value){return null==value?void 0:value.toString().startsWith(types_2.SET_ID_PREFIX)})},exports.isNotSet=function(value){return!(0,exports.isSet)(value)},exports.isUploadedList=function(value){return!!value.content.isUploadedList},exports.isRemoteComponent=function(value){return!!value.content.remoteComponent},exports.isBooleanOperator=function(sqon){return(void 0===sqon?"undefined":_type_of(sqon))==="object"&&(0,exports.isNotEmptySqon)(sqon)&&"op"in sqon&&sqon.op in operators_1.BooleanOperators},exports.isFieldOperator=function(sqon){return(void 0===sqon?"undefined":_type_of(sqon))==="object"&&(0,exports.isNotEmptySqon)(sqon)&&sqon.op in operators_1.FieldOperators},exports.isBooleanFilter=function(query){return query.content.value.every(function(val){return["false","true"].includes(val.toString().toLowerCase())})},exports.isRangeFilter=function(query){return query.op!==operators_1.RangeOperators.in&&query.op in operators_1.RangeOperators},exports.isCustomPill=function(query){return!!query.title},exports.generateEmptyQuery=function(){var sqon=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{content:[],id:(0,uuid_1.v4)(),op:operators_1.BooleanOperators.and};return Object.assign(Object.assign({},sqon),{content:[]})},exports.getDefaultSyntheticSqon=function(){var id=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,uuid_1.v4)();return{content:[],id:id,op:operators_1.BooleanOperators.and}},exports.resolveSyntheticSqon=function(sqonsList,syntheticSqon,extendedMapping){var pivots=(0,exports.findNestedSqonFields)(sqonsList,extendedMapping);return(0,exports.isBooleanOperator)(syntheticSqon)?Object.assign({content:syntheticSqon.content.map(function(c){return(0,exports.isReference)(c)?sqonsList[c]:c}).map(function(c){return(0,exports.resolveSyntheticSqon)(sqonsList,c)}),op:syntheticSqon.op},pivots.length?{pivot:pivots[0]}:null):Object.assign({content:syntheticSqon.content,op:syntheticSqon.op},pivots.length?{pivot:pivots[0]}:null)},exports.removeSqonAtIndex=function(indexToRemove,sqonsList){var result=sqonsList.filter(function(s,i){return i!==indexToRemove}).map(function(sqon){return(0,exports.isEmptySqon)(sqon)?sqon:Object.assign(Object.assign({},sqon),{content:sqon.content.filter(function(content){return content!==indexToRemove}).map(function(s){return(0,exports.isReference)(s)&&"number"==typeof s&&s>indexToRemove?s-1:s})})}),emptyQueries=result.filter(function(s){return(0,lodash_1.isEmpty)(s.content)});return emptyQueries.length?(0,exports.removeSqonAtIndex)(result.findIndex(function(s){return s.id==emptyQueries[0].id}),result):result},exports.changeCombineOperator=function(operator,syntheticSqon){return Object.assign(Object.assign({},syntheticSqon),{content:syntheticSqon.content.map(function(subContent){return(0,exports.isBooleanOperator)(subContent)&&!subContent.skipBooleanOperatorCheck?(0,exports.changeCombineOperator)(operator,subContent):subContent}),op:operator})},exports.isIndexReferencedInSqon=function(indexReference,syntheticSqon){return(0,exports.isBooleanOperator)(syntheticSqon)?syntheticSqon.content.reduce(function(acc,contentSqon){return acc||(0,exports.isIndexReferencedInSqon)(indexReference,contentSqon)},!1):"number"==typeof syntheticSqon&&syntheticSqon===indexReference},exports.removeContentFromSqon=function(indexOrField,syntheticSqon){var content=syntheticSqon.content,contentCleaned="number"==typeof indexOrField?content.filter(function(c){return c!==indexOrField}):content.filter(function(c){if("number"==typeof c)return!0;var skipBooleanOperatorCheck=c.skipBooleanOperatorCheck,isValueContentToDelete=skipBooleanOperatorCheck&&c.content[0].content.field!==indexOrField,isValueFilterToDelete=c.content.field!==indexOrField;return skipBooleanOperatorCheck?isValueContentToDelete:isValueFilterToDelete});return Object.assign(Object.assign({},syntheticSqon),{content:contentCleaned,op:syntheticSqon.op})},exports.removeQueryFromSqon=function(id,syntheticSqon){var contentCleaned=syntheticSqon.content.filter(function(contentValue){return contentValue.id!==id});return Object.assign(Object.assign({},syntheticSqon),{content:contentCleaned,op:syntheticSqon.op})},exports.termToSqon=function(param){return{content:{field:param.field,value:[param.value].flat()},op:operators_1.TermOperators.in}},exports.addToSqons=function(param){var fieldsWValues=param.fieldsWValues,sqons=param.sqons,currentSqon={content:fieldsWValues.map(function(param){var field=param.field,value=param.value;return Object.assign({},(0,exports.termToSqon)({field:field,value:value}))}),op:operators_1.BooleanOperators.and};return sqons&&0!==sqons.length?(0,exports.isEmptySqon)(sqons[sqons.length-1])?_to_consumable_array(sqons.slice(0,sqons.length-1)).concat([currentSqon]):_to_consumable_array(sqons).concat([currentSqon]):[currentSqon]},exports.deepMergeSqonValue=function(sourceSqon,newSqon,opts){var clonedSqons=(0,lodash_1.cloneDeep)(sourceSqon);return deeplySetSqonValue(clonedSqons,newSqon,opts=(0,lodash_1.merge)({},{operator:types_2.MERGE_OPERATOR_STRATEGIES.DEFAULT,values:types_2.MERGE_VALUES_STRATEGIES.DEFAULT},opts))?clonedSqons:Object.assign(Object.assign({},clonedSqons),{content:_to_consumable_array(clonedSqons.content).concat([newSqon])})};var deeplySetSqonValue=function(sourceSqon,newSqon,opts){var found=!1;return sourceSqon.content.forEach(function(sqon){if(!(0,exports.isReference)(sqon)&&!sqon.title){if((0,exports.isBooleanOperator)(sqon)){found=deeplySetSqonValue(sqon,newSqon,opts);return}sqon.content.field===newSqon.content.field&&(found=!0,newSqon.content.overrideValuesName&&(sqon.content.overrideValuesName=newSqon.content.overrideValuesName),newSqon.op&&opts.operator!==types_2.MERGE_OPERATOR_STRATEGIES.KEEP_OPERATOR&&(sqon.op=newSqon.op),opts.values===types_2.MERGE_VALUES_STRATEGIES.APPEND_VALUES&&(sqon.content.value=(0,lodash_1.union)([],sqon.content.value,newSqon.content.value)),opts.values===types_2.MERGE_VALUES_STRATEGIES.OVERRIDE_VALUES&&(sqon.content.value=newSqon.content.value))}}),found};exports.deepMergeFieldInActiveQuery=function(param){var newSqon,field=param.field,index=param.index,isUploadedList=param.isUploadedList,_param_merge_strategy=param.merge_strategy,merge_strategy=void 0===_param_merge_strategy?types_2.MERGE_VALUES_STRATEGIES.APPEND_VALUES:_param_merge_strategy,_param_operator=param.operator,operator=void 0===_param_operator?operators_1.TermOperators.in:_param_operator,overrideValuesName=param.overrideValuesName,queryBuilderId=param.queryBuilderId,remoteComponent=param.remoteComponent,value=param.value,activeQuery=(0,useQueryBuilderState_1.getActiveQuery)(queryBuilderId),newSqonContent={content:{field:field,index:index,isUploadedList:isUploadedList,overrideValuesName:overrideValuesName,remoteComponent:remoteComponent,value:value},op:operator};return(0,lodash_1.isEmpty)(activeQuery)?(newSqon=(0,exports.getDefaultSyntheticSqon)()).content=[newSqonContent]:newSqon=(0,exports.deepMergeSqonValue)(activeQuery,newSqonContent,{operator:types_2.MERGE_OPERATOR_STRATEGIES.OVERRIDE_OPERATOR,values:merge_strategy}),newSqon},exports.generateQuery=function(param){var filters=param.filters,newFilters=param.newFilters,_param_operator=param.operator,operator=void 0===_param_operator?operators_1.BooleanOperators.and:_param_operator;return(0,lodash_1.isEmpty)(filters)?{content:newFilters,id:(0,uuid_1.v4)(),op:operator}:{content:(null==filters?void 0:filters.content)?_to_consumable_array(filters.content).concat(_to_consumable_array(newFilters)):_to_consumable_array(newFilters),id:(null==filters?void 0:filters.id)||(0,uuid_1.v4)(),op:(null==filters?void 0:filters.op)||operator}},exports.generateValueFilter=function(param){var field=param.field,_param_index=param.index,index=void 0===_param_index?"":_param_index,_param_operator=param.operator,operator=void 0===_param_operator?operators_1.TermOperators.in:_param_operator,overrideValuesName=param.overrideValuesName,_param_rangeFilterNoData=param.rangeFilterNoData,basicFilter={content:{field:field,index:index,overrideValuesName:overrideValuesName,value:param.value},op:operator},noDataFilter={content:[basicFilter,{content:{field:field,index:index,value:[formatting_1.ArrangerValues.missing]},op:operators_1.RangeOperators.in}],op:operators_1.BooleanOperators.or,skipBooleanOperatorCheck:!0};return void 0!==_param_rangeFilterNoData&&_param_rangeFilterNoData?noDataFilter:basicFilter},exports.generateWildCardValueFilter=function(param){var fields=param.fields,_param_index=param.index,_param_operator=param.operator,operator=void 0===_param_operator?operators_1.FilterOperators.filter:_param_operator;return{content:{fields:fields,index:void 0===_param_index?"":_param_index,overrideValuesName:param.overrideValuesName,value:param.value},op:operator}},exports.findSqonValueByField=function(field,sqon){var prevValue=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,value=prevValue;return sqon.content.forEach(function(content){(0,exports.isReference)(content)||((0,exports.isBooleanOperator)(content)?value=value||(0,exports.findSqonValueByField)(field,content,prevValue):content.content.field!==field||(value=value||content.content.value))}),value},exports.removeFieldFromSqon=function(field,sqon){return Object.assign(Object.assign({},sqon),{content:sqon.content.filter(function f(sqon){return!!(0,exports.isReference)(sqon)||((0,exports.isBooleanOperator)(sqon)?sqon.content.filter(f).length>0:sqon.content.field!==field)})})},exports.removeFieldFromActiveQuery=function(queryBuilderId,field){return(0,exports.removeFieldFromSqon)(field,(0,useQueryBuilderState_1.getActiveQuery)(queryBuilderId))},exports.getUpdatedActiveQueryByFilterGroup=function(param){var filterGroup=param.filterGroup,index=param.index,operator=param.operator,queryBuilderId=param.queryBuilderId,selectedFilters=param.selectedFilters;return(0,exports.getUpdatedActiveQuery)({field:filterGroup.field,operator:operator,queryBuilderId:queryBuilderId,sqonContent:(0,exports.createSQONFromFilters)(filterGroup,selectedFilters,index)})},exports.getUpdatedActiveQuery=function(param){var field=param.field,_param_operator=param.operator,operator=void 0===_param_operator?operators_1.BooleanOperators.and:_param_operator,queryBuilderId=param.queryBuilderId,sqonContent=param.sqonContent,activeQuery=(0,useQueryBuilderState_1.getActiveQuery)(queryBuilderId),newQuery={content:sqonContent,op:operator};if(!(0,lodash_1.isEmpty)(activeQuery)){var _filterWithoutSelection_content,results=getFilterWithNoSelection(activeQuery,field),fieldIndex=results[0],initialResults=results[1],filterWithoutSelection=Object.assign({},initialResults);(0,lodash_1.isEmpty)(filterWithoutSelection.content)&&(0,lodash_1.isEmpty)(activeQuery)?newQuery={content:[],op:operator}:(fieldIndex>=0?(_filterWithoutSelection_content=filterWithoutSelection.content).splice.apply(_filterWithoutSelection_content,[fieldIndex,0].concat(_to_consumable_array(sqonContent))):filterWithoutSelection.content=_to_consumable_array(filterWithoutSelection.content).concat(_to_consumable_array(sqonContent)),newQuery=Object.assign(Object.assign({},filterWithoutSelection),{content:_to_consumable_array(filterWithoutSelection.content)}),0===initialResults.content.length&&(newQuery.op=operator))}return newQuery};var getFilterWithNoSelection=function(filters,field){var fieldIndex=-1,filtered=filters.content.filter(function(filter,index){if((0,exports.isReference)(filter))return!0;var skipBooleanOperatorCheck=filter.skipBooleanOperatorCheck,skipBooleanOperatorCheckField=skipBooleanOperatorCheck&&filter.content.find(function(f){return f.content.field===field});return(skipBooleanOperatorCheckField||filter.content.field==field)&&(fieldIndex=index),skipBooleanOperatorCheck?!skipBooleanOperatorCheckField:filter.content.field!==field});return[fieldIndex,Object.assign(Object.assign({},filters),{content:filtered})]};exports.createSQONFromFilters=function(filterGroup,selectedFilters,index){switch(filterGroup.type){case types_1.VisualType.Range:return(0,exports.createRangeFilter)(filterGroup.field,selectedFilters,index);case types_1.VisualType.Text:return(0,exports.createTextFilter)(filterGroup.field,selectedFilters,index);default:return(0,exports.createInlineFilters)(filterGroup.field,selectedFilters,index)}},exports.createTextFilter=function(field,filters,index){return 0===filters.length?[]:[{content:{field:field,index:index,value:[filters[0].data.text]},op:operators_1.FieldOperators.in}]};var tsqonFromRangeFilter=function(field,selectedRange,index){var noDataSelected=selectedRange.data.noDataSelected,noDataFilterContent={content:{field:field,index:index,value:[formatting_1.ArrangerValues.missing]},op:operators_1.RangeOperators.in},createContentValue=function(value,op){var baseFilter={content:{field:field,index:index,value:value},op:op};return noDataSelected?{content:[baseFilter,noDataFilterContent],op:operators_1.BooleanOperators.or,skipBooleanOperatorCheck:!0}:baseFilter};if(!(0,exports.hasSelectedRangeForOperator)(selectedRange))return noDataSelected?noDataFilterContent:null;switch(selectedRange.data.operator){case operators_1.RangeOperators.between:return void 0!==selectedRange.data.min&&void 0!==selectedRange.data.max?createContentValue([selectedRange.data.min,selectedRange.data.max],operators_1.RangeOperators[selectedRange.data.operator]):null;case operators_1.RangeOperators["<"]:case operators_1.RangeOperators["<="]:return void 0!==selectedRange.data.max?createContentValue([selectedRange.data.max],operators_1.RangeOperators[selectedRange.data.operator]):null;case operators_1.RangeOperators[">"]:case operators_1.RangeOperators[">="]:return void 0!==selectedRange.data.min?createContentValue([selectedRange.data.min],operators_1.RangeOperators[selectedRange.data.operator]):null}return null};exports.hasSelectedRangeForOperator=function(selectedRange){switch(selectedRange.data.operator){case operators_1.RangeOperators.between:return!(0,lodash_1.isUndefined)(selectedRange.data.min)&&!(0,lodash_1.isUndefined)(selectedRange.data.max);case operators_1.RangeOperators["<"]:case operators_1.RangeOperators["<="]:return!(0,lodash_1.isUndefined)(selectedRange.data.max);case operators_1.RangeOperators[">"]:case operators_1.RangeOperators[">="]:return!(0,lodash_1.isUndefined)(selectedRange.data.min);default:return!1}},exports.createRangeFilter=function(field,filters,index){return 0===filters.length?[]:filters.map(function(f){return tsqonFromRangeFilter(field,f,index)}).filter(function(f){return null!==f})},exports.createInlineFilters=function(field,filters,index){var arrayFilters=filters.map(function(v){return v.data.key}),operator=(0,lodash_1.isEmpty)(filters)?operators_1.TermOperators.in:filters[0].data.operator||operators_1.TermOperators.in;if(!(arrayFilters.length>0))return[];if(!arrayFilters.includes(formatting_1.ArrangerValues.missing))return[{content:{field:field,index:index,value:arrayFilters},op:operator}];var filterValues=arrayFilters.filter(function(item){return item!==formatting_1.ArrangerValues.missing}),op=1===filterValues.length&&operator===operators_1.TermOperators.all?operators_1.TermOperators.in:operator,noDataFilterContent={content:{field:field,index:index,value:[formatting_1.ArrangerValues.missing]},op:op};return[{content:[{content:{field:field,index:index,value:filterValues},op:op},noDataFilterContent],op:operator===operators_1.TermOperators.in?operators_1.BooleanOperators.or:operators_1.BooleanOperators.and,skipBooleanOperatorCheck:!0}]},exports.getSelectedFilters=function(param){var filterGroup=param.filterGroup,filters=param.filters,queryBuilderId=param.queryBuilderId,selectedFilters=(0,useQueryBuilderState_1.getActiveQuery)(queryBuilderId);return(0,lodash_1.isEmpty)(selectedFilters)?[]:(selectedFilters.content=selectedFilters.content.map(function(filter){if(!filter.hasOwnProperty("title"))return filter}).filter(function(filter){return filter}),filterGroup.type===types_1.VisualType.Range)?(0,Range_1.getSelectedFiltersForRange)(filters,filterGroup,selectedFilters):getSelectedFiltersOther(_to_consumable_array(filters).concat(_to_consumable_array((0,exports.formatExtraFilters)(filters,filterGroup))),filterGroup,selectedFilters)},exports.formatExtraFilters=function(currentFilters,filterGroup){var _a;return((null===(_a=filterGroup.config)||void 0===_a?void 0:_a.extraFilterDictionary)||[]).filter(function(filterKey){return!currentFilters.some(function(param){return param.id===filterKey})}).map(function(key){return(0,exports.getEmptyCountFilter)(key)})},exports.hasExtraFilterSelected=function(currentFilters,filterGroup){return currentFilters.some(function(param){var _a,id=param.id;return((null===(_a=filterGroup.config)||void 0===_a?void 0:_a.extraFilterDictionary)||[]).includes(id)})},exports.getEmptyCountFilter=function(key){return{data:{count:0,key:key},id:key,name:key}};var getSelectedFiltersOther=function(filters,filterGroup,selectedFilters){return filters.reduce(function(acc,filter){return(0,exports.isFilterSelected)(selectedFilters,filterGroup,filter.data.key)&&acc.push(filter),acc},[])};exports.isFilterSelected=function(filters,filterGroup,key){if((0,exports.isReference)(filters))return!1;if(!(0,exports.isFieldOperator)(filters))return filters.content.reduce(function(acc,contentSqon){return acc||(0,exports.isFilterSelected)(contentSqon,filterGroup,key)},!1);var valueContent=filters.content;return valueContent.value.includes(key)&&valueContent.field===filterGroup.field},exports.findNestedSqonFields=function(sqonsList,extendedMapping){if(!extendedMapping)return[];var nestedFields=[];extendedMapping.data.forEach(function(param){var field=param.field;"nested"===param.type&&nestedFields.push(field)});var pivots=[];return sqonsList.forEach(function(sqon){sqon.content&&sqon.content.forEach(function(sqonContent){var content=sqonContent.content;if(content){var field=content.field;if(!field)return;var result=nestedFields.filter(function(nestedField){return field.startsWith("".concat(nestedField,"."))});result.length>0&&pivots.push(result[0])}})}),(0,lodash_1.uniq)(pivots)}}}]);